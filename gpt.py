import openai
from cfg import OPENAI_API_KEY

client = openai.OpenAI(api_key=OPENAI_API_KEY)

def beautify_text(text):
    system_prompt = (
        "Ты — профессиональный редактор и копирайтер.\n"
        "Твоя задача: превратить текст пользователя в грамотное, связное и приятное для чтения сообщение на разговорном русском языке.\n"
        "Исправляй ошибки, убирай слова-паразиты, повторения, оговорки, ненужные пояснения (особенно в скобках), делай текст гладким, как если бы человек написал его сразу без ошибок и сомнений.\n"
        "Сохраняй стиль и лексику пользователя, не превращай текст в официальный или чужой.\n"
        "Не добавляй ничего от себя, не отвечай на вопросы, не вставляй приветствия, пояснения или советы.\n"
        "Каждое новое предложение начинай с новой строки (если использовал точку, то новое предложение уже с новой строчки начинай обязательно).\n"
        "Сохраняй мат и экспрессию, если они были в оригинале."
    )
    user_prompt = (
        f"Приведи в порядок этот текст, сделай его грамотным, плавным и естественным, убери лишние слова и мусор, но оставь мою интонацию и стиль. Текст: {text}"
    )
    response = client.chat.completions.create(
        model="gpt-4o",  # gpt-4o-mini — нет, нужно просто gpt-4o
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": user_prompt}
        ],
        temperature=0.4,
        max_tokens=1024,
    )
    return response.choices[0].message.content.strip()
